# 💡 Socket

# ✅ Socket
## Socket
네트워크 소켓(Network Socket)은 네트워크를 경유하는 프로세스 간 통신의 종착점이다.  
OSI 7 계층 중 응용 계층에 속하는 프로세스들은 데이터 송수신을 위해 반드시 소켓을 거쳐 전송 계층으로 데이터를 전달해야 한다.  
즉, 소켓은 전송 계층과 응용 프로그램 사이의 인터페이스 역할을 하며 떨어져 있는 두 호스트를 연결해 준다.

<br/>

![Untitled](https://velog.velcdn.com/images/newdana01/post/9b90db1e-11f4-4d17-b8f6-331402801d46/image.png)

<br/>

소켓은 아래의 3 가지 요소로 정의된다.  
- 프로토콜    
    : 프로토콜은 원래 외교상의 언어로써 의례나 국가 간의 약속을 의미하며 통신에서는 어떤 시스템이 다른 시스템과 통신을 원활하게 수용하도록 해 주는 통신 규약, 약속을 의미한다.    
- IP    
    : 전 세계 컴퓨터에 부여된 고유의 식별 주소를 의미한다.    
- Port    
    : 포트(Port)는 네트워크 상에서 통신하기 위해서 호스트 내부적으로 프로세스가 할당받아야 하는 고유한 숫자이다. 한 호스트 내에서 네트워크 통신을 하고 있는 프로세스를 식별하기 위해 사용되는 값이므로 같은 호스트 내에서 서로 다른 프로세스가 같은 포트 넘버를 가질 수 없다. 즉, 같은 컴퓨터 내에서 프로그램을 식별하는 번호이다.
    
<br/>

## Socket 통신
일반적으로 서버는 특정 포트가 바인딩된 소켓를 가지고 특정 컴퓨터 위에서 돌아간다. 해당 서버는 클라이언트의 연결 요청을 소켓을 통해 리스닝하면서 그냥 기다릴 뿐이다.  
클라이언트는 서버가 떠 있는 머신의 호스트 네임과 서버가 리스닝하고 있는 포트 번호를 알고 있다.  
따라서 클라이언트는 이 호스트 네임과 포트를 통해서 서버와 연결을 시도하게 된다.  
또한 클라이언트는 서버 상대로 자신을 식별시켜 주기 위해서 연결 동안 사용될 로컬 포트에 바인딩된다. 이 포트 바인딩 작업은 보통 시스템에 의해서 이뤄진다.

<br/>

![Untitled](https://docs.oracle.com/javase/tutorial/figures/networking/5connect.gif)

<br/>

만약에 모든 게 순조롭게 이뤄진다면 서버는 연결을 수락하게 된다.  
수락하자마자 서버는 동일한 로컬 포트에 바인딩된 새로운 소켓을 얻게 되며 클라이언트의 주소와 포트로 세팅된 리모트 엔드 포인트를 가지게 된다.  
서버가 별개의 새로운 소켓이 필요한 이유는 연결된 클라이언트의 요청을 처리하면서 동시에 기존의 소켓을 통해서는 지속적으로 연결 요청을 받아야 하기 때문이다.

<br/>

![Untitled](https://docs.oracle.com/javase/tutorial/figures/networking/6connect.gif)

<br/>

클라이언트 입장에서는 만약에 연결이 수락되면 소켓은 성공적으로 생성되며 클라이언트는 서버와 통신하기 위해서 소켓을 사용할 수 있게 된다.  
클라이언트와 서버는 이제 소켓에 데이터를 쓰거나 읽음으로써 통신할 수가 있게 된다.

<br/>

### Socket
소켓은 네트워크 상에서 돌아가는 두 개의 프로그램 간 양방향 통신의 하나의 엔드 포인트이다.  
소켓은 포트 번호에 바인딩되어 TCP 레이어에서 데이터가 전달되어야 하는 애플리케이션을 식별할 수 있게 한다.

<br/>

### 엔드 포인트
엔드 포인트는 아이피 주소와 포트 번호의 조합을 의미한다.  
모든 TCP 연결은 2 개의 엔드 포인트로 유일하게 식별되어질 수 있다.  
따라서 클라이언트와 서버 간 여러 개의 연결이 맺어질 수 있다.

<br/>

## 일반적인 Socket 통신의 흐름
![Untitled](https://velog.velcdn.com/images/newdana01/post/817b8ba8-4428-4e66-8128-7c01b554f8ff/image.png)

<br/>

### 서버(Server)
클라이언트 소켓의 연결 요청을 대기하고, 연결 요청이 오면 클라이언트 소켓을 생성하여 통신이 가능하게 한다.

<br/>

1. socket() 함수를 이용하여 소켓 생성
2. bind() 함수로 ip와 port 번호를 설정하게 된다.
3. listen() 함수로 클라이언트의 접근 요청에 수신 대기열을 만들어 몇 개의 클라이언트를 대기시킬지 결정
4. accept() 함수를 사용하여 클라이언트와의 연결을 기다림
    1. 데이터 송수신
    2. 소켓 닫기

<br/>

### 클라이언트(Client)
실제로 데이터 송수신이 일어나는 곳은 클라이언트 소켓이다.

<br/>

1. socket() 함수로 가장 먼저 소켓을 연다.
2. connect() 함수를 이용하여 통신할 서버의 설정된 ip와 port 번호에 통신 시도
3. 통신 시도 시, 서버가 accept() 함수를 이용하여 클라이언트의 socket descriptor를 반환
4. 이를 통해 클라이언트의 서버가 서로 read(), write()를 하며 통신 (이 과정이 반복된다.)
    1. 데이터 송수신
    2. 소켓 닫기

<br/>

## Socket 종류
### 스트림 소켓(TCP)
- TCP(Transmission Control Protocol)을 사용하는 연결 지향 방식의 소켓
- 송수신자의 연결을 보장하여 신뢰성 있는 데이터 송수신이 가능
- 데이터의 순서 보장
- 소량의 데이터보다 대량 데이터 전송에 적합
- 점대점 연결

<br/>

![Untitled](https://velog.velcdn.com/images/newdana01/post/2999a10d-fe3a-4cd4-bf5f-90c2f777a2e9/image.png)

<br/>

#### 서버(Server)
- 소켓 생성
- 바인딩
- listen (연결되지 않은 소켓을 대기 모드로 전환)
- 클라이언트 요청 수락 후 통신을 위한 실질적인 소켓 생성 (처음에 생성한 소켓은 새로운 클라이언트 요청을 대기하기 위해 쓰임)
- 데이터 송수신
- 소켓 닫음

<br/>

#### 클라이언트(Client)
- 소켓 생성
- 서버가 설정한 ip, port로 연결
- accept()로 클라이언트의 socket descriptor 반환
- 데이터 송수신
- 소켓 닫음

<br/>

### 데이터그램 소켓(UDP)
- UDP(User Diagram Protocol)을 사용하는 비연결형 소켓
- 데이터의 순서와 신뢰성을 보장하기 어려움
- 점대점뿐만 아니라 일대다 연결도 가능

<br/>

![Untitled](https://velog.velcdn.com/images/newdana01/post/6d60e795-cd8d-4823-a6a0-bca9deb50cbf/image.png)

<br/>

- accept 과정 없이 소켓 생성 후 바로 데이터 송수신

<br/>

## HTTP 통신과 Socket 통신의 차이
### HTTP 통신
- 클라이언트의 요청이 있을 때만 서버가 응답
- JSON, HTML, Image 등 다양한 데이터를 주고 받을 수 있다.
- 서버가 응답한 후 연결을 바로 종료하는 단방향 통신이지만 Keep Alive 옵션을 주어 일정 시간 동안 커넥션을 유지할 수 있다.
- 실시간 연결이 아닌 데이터 전달이 필요한 경우에만 요청을 보내는 상황에 유리

<br/>

### Socket 통신
- 클라이언트와 서버가 특정 포트를 통해 양방향 통신을 하는 방식
- 데이터 전달 후 연결이 끊어지는 것이 아니라 계속해서 연결을 유지
    - → HTTP에 비해 더 많은 리소스 소모
- 클라이언트와 서버가 실시간으로 계속하여 데이터를 주고받아야 하는 경우에 유리
- 실시간 동영상 스트리밍이나 온라인 게임 등에 사용

<br/>
<br/>

# 🗂 참고
- [소켓이란? 종류, 통신 흐름, HTTP통신과의 차이 (velog.io)](https://velog.io/@newdana01/%EC%86%8C%EC%BC%93%EC%9D%B4%EB%9E%80-%EC%A2%85%EB%A5%98-%ED%86%B5%EC%8B%A0-%ED%9D%90%EB%A6%84-HTTP%ED%86%B5%EC%8B%A0%EA%B3%BC%EC%9D%98-%EC%B0%A8%EC%9D%B4)
- [[기본] 소켓(SOCKET)통신 이란? (tistory.com)](https://helloworld-88.tistory.com/215)
- [소켓이란 무엇인가? | Engineering Blog by Dale Seo](https://www.daleseo.com/what-is-a-socket/)
