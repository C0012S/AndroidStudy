# 서비스

 **백그라운드에서 오래 실행되는 작업을 수행할 수 있는 앱 컴포넌트며 UI를 제공하지 않는다.** 

다른 앱 컴포넌트가 서비스를 시작할 수 있으며, 이는 사용자가 다른 앱으로 전환하더라도 백그라운드에서 계속 실행된다. 

이외에도 컴포넌트를 서비스에 바인딩해 서비스와 상호작용할 수 있으며, 프로세스 간 통신(IPC)도 수행할 수 있다



**백그라운드 서비스**

 사용자에게 직접적으로 안 보이는 작업 수행 / 게시물을 SNS에 공유한 후 다른 화면에서 다른 사람들의 게시물들을 본다. 이 때 내 게시물을 공유하고 다른 화면으로 넘어가거나 앱을 종료해도 게시물 업로드는 종료되지 않고 백그라운드 서비스가 시작되어, 업로드는 진행중이나 사용자는 이걸 눈으로 보진 못한다.

- 사용자에게 안 보이는 작업을 수행한다
- 인스타에서 게시물 공유 버튼을 눌러 인스타에 사진을 업로드하는 동안 카톡하거나 인스타를 꺼도 게시물 업로드는 종료되지 않는다. 이 때 백그라운드 서비스가 사용됨

**포그라운드 서비스** 

 사용자에게 잘 보이는 몇몇 작업 수행 / 멜론, 플레이 스토어 같은 앱은 노래 재생 시 포그라운드 서비스를 시작한다. 사용자는 상태바의 알림창을 통해 노래의 일시정지, 재생 등의 동작을 수행할 수 있고 다운로드가 얼마나 됐는지 알 수 있다. 이처럼 포그라운드 서비스는 알림을 꼭 표시해야 한다. 포그라운드 서비스가 실행되고 5초 안에 알림을 표시하지 않으면 ANR이 발생하며, 사용자가 앱과 상호작용하지 않을 때도 계속 실행된다. 또한 메모리가 부족하더라도 시스템에 의해 강제종료되지 않는다.

⇒

- 사용자가 입력한 명령이 실행되어 결과가 출력될 때까지 기다려야 하는 방식으로 처리되는 서비스
- 유저가 현재 뭘 하고 있다는 걸 인지하고 있는 서비스다
- 그래서 메모리 부족 시 안드로이드 시스템에 의한 강제종료 대상에서 제외된다
- 대신 포그라운드 서비스가 실행되는 도중엔 무조건 상태바에 알림이 제공돼야 한다.
- 앱과 사용자가 상호작용하지 않아도 계속 실행된다
- 포그라운드 프로세스 : 화면에서 앱이 어던 작업을 하는지 눈으로 볼 수 있는 프로세스(유튜브 시청, 웹 서핑)

 
**바인드 서비스**
    - 클라이언트-서버 구조처럼 컴포넌트가 서비스에 연결되면 서비스가 서버 역할을 한다
    - 컴포넌트가 서비스에게 요청하면 서비스는 그것에 맞는 결과값을 리턴한다
    - 클라이언트가 연결을 해제하고 서비스와 연결된 클라이언트가 없을 때 바인드 서비스가 종료된다

<br>

## startService
    
  ### **특징**
    
  1. 특정 서비스를 백그라운드로 동작시키는 것에 목적을 둔 형태.
    
  2. 발생시킨 곳에서는 중단시키는 것 이외에는 어떤 제어도 불가능하다.
    
  3. 발생시키는 곳과 서비스는 독립적이여서 Activity가 종료되어도 동작한다.
  
<br>

  **주의할점**
    
   Service도 Main Thread에 속해서 동작한다는 점이다.
    
  그래서 반드시 ANR에 걸릴만한 작업은 Sub Thread를 통해서 동작시켜야 한다.
    
   Thread로 종료시킬 때, Service가 종료된다면 반드시 Thread도 interrupt() 로 종료해주고
    
  null로 초기화 해줘야한다. 당연히 이러한 작업을 하는 위치는 onDestroy method이다. 

<br>
    
 **onStartCommand의 반환값**
    
  서비스가 동작중일땐 onStartCommand의 코드가 계속해서 동작하는 것
    
  Service가 실행되는 도중 시스템이 자원이 부족해서 강제로 Service를 종료시킬 수도 있다.
    
  이 때 onStartCommand의 반환값이 **START_STICKY** 이면 자원이 확보되는대로 다시 Service를 동작시킨다.
    
  그러나 **START_NOT_STICKY**를 반환한다면 사용자가 다시 Service를 실행시키지 않는한 실행되지 않는다.

<br>
    
**Service의 종료**

   stopService
    
   Service가 자기할일을 마치고 스스로 종료하게 하는 방법은 다음 함수를 사용하면 된다. ( stopSelf, stopSelfResult )
